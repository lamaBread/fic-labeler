<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ëŒ€ì‹œë³´ë“œ - ì†Œì„¤ ì‹œê°„íë¦„ ë¼ë²¨ë§ ì‹œìŠ¤í…œ</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <h1>ğŸ“š ë¼ë²¨ë§ ëŒ€ì‹œë³´ë“œ</h1>
                <div class="user-info">
                    <span id="userNickname"></span>
                    <button id="logoutBtn" class="btn btn-small">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </header>

        <main>
            <!-- ì „ì²´ ì§„í–‰ ìƒí™© -->
            <section class="progress-section">
                <h2>ğŸ“Š ì „ì²´ ì§„í–‰ ìƒí™©</h2>
                <div class="overall-progress">
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="overallProgressBar"></div>
                    </div>
                    <div class="progress-stats">
                        <span id="completedCount">0</span> / <span id="totalCount">0</span> ë¬¸ì¥
                        (<span id="progressPercent">0</span>%)
                    </div>
                </div>
                <button id="startLabelingBtn" class="btn btn-primary btn-large">
                    ğŸ·ï¸ ë¼ë²¨ë§ ì‹œì‘í•˜ê¸°
                </button>
            </section>

            <!-- ì‘í’ˆë³„ ì§„í–‰ ìƒí™© -->
            <section class="documents-section">
                <h2>ğŸ“– ì‘í’ˆë³„ ì§„í–‰ ìƒí™©</h2>
                <div id="documentsList" class="documents-list">
                    <p class="loading">ë¡œë”© ì¤‘...</p>
                </div>
            </section>

            <!-- ë¼ë²¨ë§ ê°€ì´ë“œ -->
            <section class="guide-section">
                <h2>ğŸ“ ë¼ë²¨ë§ ê°€ì´ë“œ</h2>
                <div class="guide-content">
                    <div class="guide-item">
                        <h3>narratedtime (í•„ìˆ˜)</h3>
                        <p>í…ìŠ¤íŠ¸ ë‚´ì—ì„œ ì„œìˆ ëœ ì‹œê°„ì˜ ì–‘(ë¶„ ë‹¨ìœ„)ì…ë‹ˆë‹¤. ì˜ˆ: í•œ ë¬¸ë‹¨ì—ì„œ 1ì‹œê°„ì´ í˜ë €ë‹¤ë©´ 60ì„ ì…ë ¥.</p>
                    </div>
                    <div class="guide-item">
                        <h3>ellipsistime (ì„ íƒ)</h3>
                        <p>ìƒëµëœ ì‹œê°„(ë¶„ ë‹¨ìœ„)ì…ë‹ˆë‹¤. "ë©°ì¹  í›„", "ëª‡ ë…„ì´ ì§€ë‚˜" ë“±ìœ¼ë¡œ ìƒëµëœ ì‹œê°„.</p>
                    </div>
                    <div class="guide-item">
                        <h3>subjectivetime (ì„ íƒ)</h3>
                        <p>ì£¼ê´€ì ìœ¼ë¡œ ëŠê»´ì§€ëŠ” ì‹œê°„(ë¶„ ë‹¨ìœ„)ì…ë‹ˆë‹¤. íšŒìƒ, ê¿ˆ ë“± ì‹¤ì œ ì‹œê°„ê³¼ ë‹¤ë¥´ê²Œ ëŠê»´ì§€ëŠ” ê²½ìš°.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Based on Ted Underwood's "Why Literary Time is Measured in Minutes"</p>
        </footer>
    </div>

    <script src="js/common.js"></script>
    <script>
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸
        (async function init() {
            const key = localStorage.getItem('labeler_key');
            if (!key) {
                window.location.href = 'index.html';
                return;
            }

            // ì„¸ì…˜ í™•ì¸ì„ ìœ„í•´ ë‹¤ì‹œ ë¡œê·¸ì¸
            const loginResponse = await api.login(key);
            if (!loginResponse.success) {
                localStorage.removeItem('labeler_key');
                window.location.href = 'index.html';
                return;
            }

            document.getElementById('userNickname').textContent = 
                localStorage.getItem('labeler_nickname') || 'ë¼ë²¨ëŸ¬';

            await loadProgress();
        })();

        // ì§„í–‰ ìƒí™© ë¡œë“œ
        async function loadProgress() {
            try {
                const response = await api.getProgress();
                
                if (response.success) {
                    const { overall, documents } = response.data;
                    
                    // ì „ì²´ ì§„í–‰ë¥  ì—…ë°ì´íŠ¸
                    document.getElementById('completedCount').textContent = overall.completed;
                    document.getElementById('totalCount').textContent = overall.total;
                    document.getElementById('progressPercent').textContent = overall.percentage;
                    document.getElementById('overallProgressBar').style.width = overall.percentage + '%';
                    
                    // ì‘í’ˆë³„ ëª©ë¡ ìƒì„±
                    const listEl = document.getElementById('documentsList');
                    listEl.innerHTML = '';
                    
                    if (Object.keys(documents).length === 0) {
                        listEl.innerHTML = '<p class="no-data">í• ë‹¹ëœ ì‘í’ˆì´ ì—†ìŠµë‹ˆë‹¤.</p>';
                        return;
                    }
                    
                    for (const [docKey, doc] of Object.entries(documents)) {
                        const card = document.createElement('div');
                        card.className = 'document-card';
                        if (doc.percentage === 100) {
                            card.classList.add('completed');
                        }
                        
                        card.innerHTML = `
                            <div class="doc-info">
                                <span class="doc-id">${doc.docid}</span>
                                <h3 class="doc-title">${doc.title}</h3>
                                <span class="doc-author">${doc.author}</span>
                            </div>
                            <div class="doc-progress">
                                <div class="mini-progress-bar">
                                    <div class="mini-progress-fill" style="width: ${doc.percentage}%"></div>
                                </div>
                                <span class="doc-stats">${doc.completed}/${doc.total} (${doc.percentage}%)</span>
                            </div>
                            <button class="btn btn-small" onclick="startLabeling('${docKey}')">
                                ${doc.percentage === 100 ? 'ìˆ˜ì •í•˜ê¸°' : 'ë¼ë²¨ë§'}
                            </button>
                        `;
                        
                        listEl.appendChild(card);
                    }
                }
            } catch (error) {
                console.error('Error loading progress:', error);
            }
        }

        // ë¼ë²¨ë§ ì‹œì‘
        document.getElementById('startLabelingBtn').addEventListener('click', function() {
            window.location.href = 'labeling.html';
        });

        // íŠ¹ì • ë¬¸ì„œ ë¼ë²¨ë§ ì‹œì‘
        function startLabeling(docKey) {
            sessionStorage.setItem('current_doc_key', docKey);
            window.location.href = 'labeling.html?doc=' + encodeURIComponent(docKey);
        }

        // ë¡œê·¸ì•„ì›ƒ
        document.getElementById('logoutBtn').addEventListener('click', async function() {
            await api.logout();
            localStorage.removeItem('labeler_key');
            localStorage.removeItem('labeler_nickname');
            window.location.href = 'index.html';
        });
    </script>
</body>
</html>
